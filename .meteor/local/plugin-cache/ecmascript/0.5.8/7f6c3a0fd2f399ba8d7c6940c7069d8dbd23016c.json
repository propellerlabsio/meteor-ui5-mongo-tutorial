{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"/packages/propellerlabsio:meteor-ui5-mongo/model/Model.js","filenameRelative":"/packages/propellerlabsio:meteor-ui5-mongo/model/Model.js","env":{},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":false,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/packages/propellerlabsio:meteor-ui5-mongo/model/Model.js.map","sourceFileName":"/packages/propellerlabsio:meteor-ui5-mongo/model/Model.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"basename":"Model"},"ignored":false,"code":"\"use strict\";\nsap.ui.define([\"jquery.sap.global\", \"sap/ui/model/Model\", \"sap/ui/model/BindingMode\", \"sap/ui/model/Context\", \"./DocumentListBinding\", \"./PropertyListBinding\", \"./PropertyBinding\", \"./ContextBinding\", \"sap/ui/model/FilterOperator\"], function (a, b, c, d, e, f, g, h, i) {\n  var j = b.extend(\"meteor-ui5-mongo.model.Model\", { constructor: function constructor(a) {\n      b.apply(this, arguments), this.oData = {}, this.bDestroyed = !1, this.aBindings = [], this.mContexts = {}, this.iSizeLimit = a || 100, this.sDefaultBindingMode = c.OneWay, this.mSupportedBindingModes = { OneWay: !0, TwoWay: !1, OneTime: !1 }, this.bLegacySyntax = !1, this.sUpdateTimer = null;\n    } });return j.prototype.bindProperty = function (a, b, c) {\n    var d = new g(this, a, b, c);return d;\n  }, j.prototype.bindList = function (a, b, c, d, g) {\n    var h;return h = b ? new f(this, a, b, c, d, g) : new e(this, a, b, c, d, g);\n  }, j.prototype.createBindingContext = function (a, b, c, d) {\n    \"function\" == typeof b && (d = b, b = null), \"function\" == typeof c && (d = c, c = null);var e = this.resolve(a, b),\n        f = void 0 == e ? void 0 : this.getContext(e ? e : \"/\");return f || (f = null), d && d(f), f;\n  }, j.prototype.destroyBindingContext = function (a) {\n    a.hasOwnProperty(\"destroy\") && a.destroy();\n  }, j.prototype.getProperty = function (a, b) {\n    var c = void 0;if (b) {\n      var d = this._getPathComponents(a, b),\n          e = Mongo.Collection.get(d.collectionName).findOne(d.documentId);return e && (c = d.propertyPath ? \"?\" === d.propertyPath.charAt(0) ? this._getLookupProperty(e, d.propertyPath) : this._get(e, d.propertyPath) : e), c;\n    }\n  }, j.prototype._getLookupProperty = function (a, b) {\n    var c = this._getPathComponents(b),\n        d = \"/\" + c.collectionName + \"(\" + a[c.documentId] + \")\",\n        e = this.getContext(d);return this.getProperty(c.propertyPath, e);\n  }, j.prototype._getPathComponents = function (b, c) {\n    var d = { collectionName: \"\", documentId: \"\", propertyPath: \"\" },\n        e = c ? this.resolve(b, c) : b,\n        f = e.charAt(0);if (\"?\" === f) e = \"/\" + e.slice(1);else if (\"/\" !== f) {\n      var g = \"Cannot find root element (Mongo Collection).\";a.sap.log.fatal(g), this.fireParseError({ srcText: g });\n    }var h = e.split(\"/\");if (\"\" === h[0] && h.shift(), h.length < 1) {\n      var i = \"Unsupported binding path: \" + e;a.sap.log.fatal(i), oModel.fireParseError({ srcText: i });\n    }var j = h[0],\n        k = j.indexOf(\"(\");if (k < 0) d.collectionName = j;else {\n      d.collectionName = j.substring(0, k);var l = j.substring(k),\n          m = 0,\n          n = l.length - 1,\n          o = l.substring(m + 1, n);if (o.startsWith(\"Object\")) {\n        var p = o.indexOf('\"'),\n            q = o.indexOf('\"', p + 1),\n            r = o.substring(p + 1, q);d.documentId = new Meteor.Collection.ObjectID(r);\n      } else d.documentId = o;\n    }h.shift();var s = h.join(\".\");if (s) {\n      var t = s.indexOf(\")\");if (t > -1) {\n        var u = t + 1;\".\" === s.charAt(u) && (s = s.substr(0, u) + \"/\" + s.substr(t + 1));\n      }\n    }return d.propertyPath = s, d;\n  }, j.prototype.runQuery = function (a, b, c, d) {\n    var e = this._getPathComponents(a, b),\n        f = Mongo.Collection.get(e.collectionName),\n        g = {};e.documentId ? g._id = e.documentId : d && d.length && (g = this._buildMongoSelector(d));var h = { limit: this.iSizeLimit };c && c.length && (h.sort = this._buildMongoSortSpecifier(c));var i = f.find(g, h);return i;\n  }, j.prototype.bindContext = function (a, b, c) {\n    var d = new h(this, a, b, c);return d;\n  }, j.prototype.destroy = function () {\n    this.aBindings.forEach(function (a) {\n      a.hasOwnProperty(\"destroy\") && a.destroy();\n    }), b.prototype.destroy.apply(this, arguments);\n  }, j.prototype._buildMongoSelector = function (b) {\n    var c = this,\n        d = {},\n        e = new Map();b.forEach(function (b) {\n      if (b._bMultiFilter) {\n        var d = \"MultiFilter not yet supported by ListBinding.\";return a.sap.log.fatal(d), void c.oModel.fireParseError({ srcText: d });\n      }var f = {};switch (b.sOperator) {case i.BT:\n          f.$gte = b.oValue1, f.$lte = b.oValue2;break;case i.Contains:\n          f.$regex = new RegExp(b.oValue1), f.$options = \"i\";break;case i.StartsWith:\n          f.$regex = new RegExp(\"^\" + b.oValue1), f.$options = \"i\";break;case i.EndsWith:\n          f.$regex = new RegExp(b.oValue1 + \"$\"), f.$options = \"i\";break;case i.EQ:\n          f = b.oValue1;break;case i.GE:\n          f.$gte = b.oValue1;case i.GT:\n          f.$gt = b.oValue1;break;case i.LE:\n          f.$lte = b.oValue1;break;case i.LT:\n          f.$lt = b.oValue1;break;case i.NE:\n          f.$ne = b.oValue1;break;default:\n          var g = \"Filter operator \" + b.sOperator + \" not supported.\";return a.sap.log.fatal(g), void c.oModel.fireParseError({ srcText: g });}var h = b.sPath;e.has(h) || e.set(h, []);var j = {};j[h] = f, e.get(h).push(j);\n    });var f = [];return e.forEach(function (a) {\n      1 === a.length ? f.push(a[0]) : f.push({ $or: a });\n    }), f.length > 1 ? d.$and = f : d = f[0], d;\n  }, j.prototype._buildMongoSortSpecifier = function (b) {\n    var c = this,\n        d = {};return b.forEach(function (b) {\n      var e = b.sPath.indexOf(\"/\") > -1,\n          f = b.sPath.indexOf(\".\") > -1;if (e || f) {\n        var g = \"Currently unsupported list sorting path: \" + b.sPath;return a.sap.log.fatal(g), void c.oModel.fireParseError({ srcText: g });\n      }if (b.fnCompare) {\n        var h = \"Custom sort comparator functions currently unsupported\";return a.sap.log.fatal(h), void c.oModel.fireParseError({ srcText: h });\n      }d[b.sPath] = b.bDescending ? -1 : 1;\n    }), d;\n  }, j.prototype._get = function (a, b, c) {\n    function d(b) {\n      return !(b && void 0 === (a = a[b]));\n    }var e = b.replace(/\\[/g, \".\").replace(/]/g, \"\").split(\".\").filter(Boolean);return e.every(d) ? a : c;\n  }, j;\n});","ast":null,"map":{"version":3,"sources":["/packages/propellerlabsio:meteor-ui5-mongo/model/Model.js"],"names":[],"mappings":"AAAA;AAAa,IAAI,EAAJ,CAAO,MAAP,CAAc,CAAC,mBAAD,EAAqB,oBAArB,EAA0C,0BAA1C,EAAqE,sBAArE,EAA4F,uBAA5F,EAAoH,uBAApH,EAA4I,mBAA5I,EAAgK,kBAAhK,EAAmL,6BAAnL,CAAd,EAAgO,UAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,EAAiB,CAAjB,EAAmB,CAAnB,EAAqB,CAArB,EAAuB,CAAvB,EAAyB,CAAzB,EAA2B;AAAC,MAAI,IAAE,EAAE,MAAF,CAAS,8BAAT,EAAwC,EAAC,aAAY,qBAAS,CAAT,EAAW;AAAC,QAAE,KAAF,CAAQ,IAAR,EAAa,SAAb,GAAwB,KAAK,KAAL,GAAW,EAAnC,EAAsC,KAAK,UAAL,GAAgB,CAAC,CAAvD,EAAyD,KAAK,SAAL,GAAe,EAAxE,EAA2E,KAAK,SAAL,GAAe,EAA1F,EAA6F,KAAK,UAAL,GAAgB,KAAG,GAAhH,EAAoH,KAAK,mBAAL,GAAyB,EAAE,MAA/I,EAAsJ,KAAK,sBAAL,GAA4B,EAAC,QAAO,CAAC,CAAT,EAAW,QAAO,CAAC,CAAnB,EAAqB,SAAQ,CAAC,CAA9B,EAAlL,EAAmN,KAAK,aAAL,GAAmB,CAAC,CAAvO,EAAyO,KAAK,YAAL,GAAkB,IAA3P;AAAgQ,KAAzR,EAAxC,CAAN,CAA0U,OAAO,EAAE,SAAF,CAAY,YAAZ,GAAyB,UAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe;AAAC,QAAI,IAAE,IAAI,CAAJ,CAAM,IAAN,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,CAAN,CAAwB,OAAO,CAAP;AAAS,GAA1E,EAA2E,EAAE,SAAF,CAAY,QAAZ,GAAqB,UAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,EAAiB,CAAjB,EAAmB;AAAC,QAAI,CAAJ,CAAM,OAAO,IAAE,IAAE,IAAI,CAAJ,CAAM,IAAN,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,EAAiB,CAAjB,EAAmB,CAAnB,CAAF,GAAwB,IAAI,CAAJ,CAAM,IAAN,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,EAAiB,CAAjB,EAAmB,CAAnB,CAAjC;AAAuD,GAAjL,EAAkL,EAAE,SAAF,CAAY,oBAAZ,GAAiC,UAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,EAAiB;AAAC,kBAAY,OAAO,CAAnB,KAAuB,IAAE,CAAF,EAAI,IAAE,IAA7B,GAAmC,cAAY,OAAO,CAAnB,KAAuB,IAAE,CAAF,EAAI,IAAE,IAA7B,CAAnC,CAAsE,IAAI,IAAE,KAAK,OAAL,CAAa,CAAb,EAAe,CAAf,CAAN;AAAA,QAAwB,IAAE,KAAK,CAAL,IAAQ,CAAR,GAAU,KAAK,CAAf,GAAiB,KAAK,UAAL,CAAgB,IAAE,CAAF,GAAI,GAApB,CAA3C,CAAoE,OAAO,MAAI,IAAE,IAAN,GAAY,KAAG,EAAE,CAAF,CAAf,EAAoB,CAA3B;AAA6B,GAA5Y,EAA6Y,EAAE,SAAF,CAAY,qBAAZ,GAAkC,UAAS,CAAT,EAAW;AAAC,MAAE,cAAF,CAAiB,SAAjB,KAA6B,EAAE,OAAF,EAA7B;AAAyC,GAApe,EAAqe,EAAE,SAAF,CAAY,WAAZ,GAAwB,UAAS,CAAT,EAAW,CAAX,EAAa;AAAC,QAAI,IAAE,KAAK,CAAX,CAAa,IAAG,CAAH,EAAK;AAAC,UAAI,IAAE,KAAK,kBAAL,CAAwB,CAAxB,EAA0B,CAA1B,CAAN;AAAA,UAAmC,IAAE,MAAM,UAAN,CAAiB,GAAjB,CAAqB,EAAE,cAAvB,EAAuC,OAAvC,CAA+C,EAAE,UAAjD,CAArC,CAAkG,OAAO,MAAI,IAAE,EAAE,YAAF,GAAe,QAAM,EAAE,YAAF,CAAe,MAAf,CAAsB,CAAtB,CAAN,GAA+B,KAAK,kBAAL,CAAwB,CAAxB,EAA0B,EAAE,YAA5B,CAA/B,GAAyE,KAAK,IAAL,CAAU,CAAV,EAAY,EAAE,YAAd,CAAxF,GAAoH,CAA1H,GAA6H,CAApI;AAAsI;AAAC,GAAvwB,EAAwwB,EAAE,SAAF,CAAY,kBAAZ,GAA+B,UAAS,CAAT,EAAW,CAAX,EAAa;AAAC,QAAI,IAAE,KAAK,kBAAL,CAAwB,CAAxB,CAAN;AAAA,QAAiC,IAAE,MAAI,EAAE,cAAN,GAAqB,GAArB,GAAyB,EAAE,EAAE,UAAJ,CAAzB,GAAyC,GAA5E;AAAA,QAAgF,IAAE,KAAK,UAAL,CAAgB,CAAhB,CAAlF,CAAqG,OAAO,KAAK,WAAL,CAAiB,EAAE,YAAnB,EAAgC,CAAhC,CAAP;AAA0C,GAAp8B,EAAq8B,EAAE,SAAF,CAAY,kBAAZ,GAA+B,UAAS,CAAT,EAAW,CAAX,EAAa;AAAC,QAAI,IAAE,EAAC,gBAAe,EAAhB,EAAmB,YAAW,EAA9B,EAAiC,cAAa,EAA9C,EAAN;AAAA,QAAwD,IAAE,IAAE,KAAK,OAAL,CAAa,CAAb,EAAe,CAAf,CAAF,GAAoB,CAA9E;AAAA,QAAgF,IAAE,EAAE,MAAF,CAAS,CAAT,CAAlF,CAA8F,IAAG,QAAM,CAAT,EAAW,IAAE,MAAI,EAAE,KAAF,CAAQ,CAAR,CAAN,CAAX,KAAiC,IAAG,QAAM,CAAT,EAAW;AAAC,UAAI,IAAE,8CAAN,CAAqD,EAAE,GAAF,CAAM,GAAN,CAAU,KAAV,CAAgB,CAAhB,GAAmB,KAAK,cAAL,CAAoB,EAAC,SAAQ,CAAT,EAApB,CAAnB;AAAoD,SAAI,IAAE,EAAE,KAAF,CAAQ,GAAR,CAAN,CAAmB,IAAG,OAAK,EAAE,CAAF,CAAL,IAAW,EAAE,KAAF,EAAX,EAAqB,EAAE,MAAF,GAAS,CAAjC,EAAmC;AAAC,UAAI,IAAE,+BAA6B,CAAnC,CAAqC,EAAE,GAAF,CAAM,GAAN,CAAU,KAAV,CAAgB,CAAhB,GAAmB,OAAO,cAAP,CAAsB,EAAC,SAAQ,CAAT,EAAtB,CAAnB;AAAsD,SAAI,IAAE,EAAE,CAAF,CAAN;AAAA,QAAW,IAAE,EAAE,OAAF,CAAU,GAAV,CAAb,CAA4B,IAAG,IAAE,CAAL,EAAO,EAAE,cAAF,GAAiB,CAAjB,CAAP,KAA8B;AAAC,QAAE,cAAF,GAAiB,EAAE,SAAF,CAAY,CAAZ,EAAc,CAAd,CAAjB,CAAkC,IAAI,IAAE,EAAE,SAAF,CAAY,CAAZ,CAAN;AAAA,UAAqB,IAAE,CAAvB;AAAA,UAAyB,IAAE,EAAE,MAAF,GAAS,CAApC;AAAA,UAAsC,IAAE,EAAE,SAAF,CAAY,IAAE,CAAd,EAAgB,CAAhB,CAAxC,CAA2D,IAAG,EAAE,UAAF,CAAa,QAAb,CAAH,EAA0B;AAAC,YAAI,IAAE,EAAE,OAAF,CAAU,GAAV,CAAN;AAAA,YAAqB,IAAE,EAAE,OAAF,CAAU,GAAV,EAAc,IAAE,CAAhB,CAAvB;AAAA,YAA0C,IAAE,EAAE,SAAF,CAAY,IAAE,CAAd,EAAgB,CAAhB,CAA5C,CAA+D,EAAE,UAAF,GAAa,IAAI,OAAO,UAAP,CAAkB,QAAtB,CAA+B,CAA/B,CAAb;AAA+C,OAAzI,MAA8I,EAAE,UAAF,GAAa,CAAb;AAAe,OAAE,KAAF,GAAU,IAAI,IAAE,EAAE,IAAF,CAAO,GAAP,CAAN,CAAkB,IAAG,CAAH,EAAK;AAAC,UAAI,IAAE,EAAE,OAAF,CAAU,GAAV,CAAN,CAAqB,IAAG,IAAE,CAAC,CAAN,EAAQ;AAAC,YAAI,IAAE,IAAE,CAAR,CAAU,QAAM,EAAE,MAAF,CAAS,CAAT,CAAN,KAAoB,IAAE,EAAE,MAAF,CAAS,CAAT,EAAW,CAAX,IAAc,GAAd,GAAkB,EAAE,MAAF,CAAS,IAAE,CAAX,CAAxC;AAAuD;AAAC,YAAO,EAAE,YAAF,GAAe,CAAf,EAAiB,CAAxB;AAA0B,GAAz0D,EAA00D,EAAE,SAAF,CAAY,QAAZ,GAAqB,UAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,EAAiB;AAAC,QAAI,IAAE,KAAK,kBAAL,CAAwB,CAAxB,EAA0B,CAA1B,CAAN;AAAA,QAAmC,IAAE,MAAM,UAAN,CAAiB,GAAjB,CAAqB,EAAE,cAAvB,CAArC;AAAA,QAA4E,IAAE,EAA9E,CAAiF,EAAE,UAAF,GAAa,EAAE,GAAF,GAAM,EAAE,UAArB,GAAgC,KAAG,EAAE,MAAL,KAAc,IAAE,KAAK,mBAAL,CAAyB,CAAzB,CAAhB,CAAhC,CAA6E,IAAI,IAAE,EAAC,OAAM,KAAK,UAAZ,EAAN,CAA8B,KAAG,EAAE,MAAL,KAAc,EAAE,IAAF,GAAO,KAAK,wBAAL,CAA8B,CAA9B,CAArB,EAAuD,IAAI,IAAE,EAAE,IAAF,CAAO,CAAP,EAAS,CAAT,CAAN,CAAkB,OAAO,CAAP;AAAS,GAA/nE,EAAgoE,EAAE,SAAF,CAAY,WAAZ,GAAwB,UAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe;AAAC,QAAI,IAAE,IAAI,CAAJ,CAAM,IAAN,EAAW,CAAX,EAAa,CAAb,EAAe,CAAf,CAAN,CAAwB,OAAO,CAAP;AAAS,GAAzsE,EAA0sE,EAAE,SAAF,CAAY,OAAZ,GAAoB,YAAU;AAAC,SAAK,SAAL,CAAe,OAAf,CAAuB,UAAS,CAAT,EAAW;AAAC,QAAE,cAAF,CAAiB,SAAjB,KAA6B,EAAE,OAAF,EAA7B;AAAyC,KAA5E,GAA8E,EAAE,SAAF,CAAY,OAAZ,CAAoB,KAApB,CAA0B,IAA1B,EAA+B,SAA/B,CAA9E;AAAwH,GAAj2E,EAAk2E,EAAE,SAAF,CAAY,mBAAZ,GAAgC,UAAS,CAAT,EAAW;AAAC,QAAI,IAAE,IAAN;AAAA,QAAW,IAAE,EAAb;AAAA,QAAgB,IAAE,IAAI,GAAJ,EAAlB,CAA0B,EAAE,OAAF,CAAU,UAAS,CAAT,EAAW;AAAC,UAAG,EAAE,aAAL,EAAmB;AAAC,YAAI,IAAE,+CAAN,CAAsD,OAAO,EAAE,GAAF,CAAM,GAAN,CAAU,KAAV,CAAgB,CAAhB,GAAmB,KAAK,EAAE,MAAF,CAAS,cAAT,CAAwB,EAAC,SAAQ,CAAT,EAAxB,CAA/B;AAAoE,WAAI,IAAE,EAAN,CAAS,QAAO,EAAE,SAAT,GAAoB,KAAK,EAAE,EAAP;AAAU,YAAE,IAAF,GAAO,EAAE,OAAT,EAAiB,EAAE,IAAF,GAAO,EAAE,OAA1B,CAAkC,MAAM,KAAK,EAAE,QAAP;AAAgB,YAAE,MAAF,GAAS,IAAI,MAAJ,CAAW,EAAE,OAAb,CAAT,EAA+B,EAAE,QAAF,GAAW,GAA1C,CAA8C,MAAM,KAAK,EAAE,UAAP;AAAkB,YAAE,MAAF,GAAS,IAAI,MAAJ,CAAW,MAAI,EAAE,OAAjB,CAAT,EAAmC,EAAE,QAAF,GAAW,GAA9C,CAAkD,MAAM,KAAK,EAAE,QAAP;AAAgB,YAAE,MAAF,GAAS,IAAI,MAAJ,CAAW,EAAE,OAAF,GAAU,GAArB,CAAT,EAAmC,EAAE,QAAF,GAAW,GAA9C,CAAkD,MAAM,KAAK,EAAE,EAAP;AAAU,cAAE,EAAE,OAAJ,CAAY,MAAM,KAAK,EAAE,EAAP;AAAU,YAAE,IAAF,GAAO,EAAE,OAAT,CAAiB,KAAK,EAAE,EAAP;AAAU,YAAE,GAAF,GAAM,EAAE,OAAR,CAAgB,MAAM,KAAK,EAAE,EAAP;AAAU,YAAE,IAAF,GAAO,EAAE,OAAT,CAAiB,MAAM,KAAK,EAAE,EAAP;AAAU,YAAE,GAAF,GAAM,EAAE,OAAR,CAAgB,MAAM,KAAK,EAAE,EAAP;AAAU,YAAE,GAAF,GAAM,EAAE,OAAR,CAAgB,MAAM;AAAQ,cAAI,IAAE,qBAAmB,EAAE,SAArB,GAA+B,iBAArC,CAAuD,OAAO,EAAE,GAAF,CAAM,GAAN,CAAU,KAAV,CAAgB,CAAhB,GAAmB,KAAK,EAAE,MAAF,CAAS,cAAT,CAAwB,EAAC,SAAQ,CAAT,EAAxB,CAA/B,CAAnhB,CAAulB,IAAI,IAAE,EAAE,KAAR,CAAc,EAAE,GAAF,CAAM,CAAN,KAAU,EAAE,GAAF,CAAM,CAAN,EAAQ,EAAR,CAAV,CAAsB,IAAI,IAAE,EAAN,CAAS,EAAE,CAAF,IAAK,CAAL,EAAO,EAAE,GAAF,CAAM,CAAN,EAAS,IAAT,CAAc,CAAd,CAAP;AAAwB,KAAz0B,EAA20B,IAAI,IAAE,EAAN,CAAS,OAAO,EAAE,OAAF,CAAU,UAAS,CAAT,EAAW;AAAC,YAAI,EAAE,MAAN,GAAa,EAAE,IAAF,CAAO,EAAE,CAAF,CAAP,CAAb,GAA0B,EAAE,IAAF,CAAO,EAAC,KAAI,CAAL,EAAP,CAA1B;AAA0C,KAAhE,GAAkE,EAAE,MAAF,GAAS,CAAT,GAAW,EAAE,IAAF,GAAO,CAAlB,GAAoB,IAAE,EAAE,CAAF,CAAxF,EAA6F,CAApG;AAAsG,GAAl2G,EAAm2G,EAAE,SAAF,CAAY,wBAAZ,GAAqC,UAAS,CAAT,EAAW;AAAC,QAAI,IAAE,IAAN;AAAA,QAAW,IAAE,EAAb,CAAgB,OAAO,EAAE,OAAF,CAAU,UAAS,CAAT,EAAW;AAAC,UAAI,IAAE,EAAE,KAAF,CAAQ,OAAR,CAAgB,GAAhB,IAAqB,CAAC,CAA5B;AAAA,UAA8B,IAAE,EAAE,KAAF,CAAQ,OAAR,CAAgB,GAAhB,IAAqB,CAAC,CAAtD,CAAwD,IAAG,KAAG,CAAN,EAAQ;AAAC,YAAI,IAAE,8CAA4C,EAAE,KAApD,CAA0D,OAAO,EAAE,GAAF,CAAM,GAAN,CAAU,KAAV,CAAgB,CAAhB,GAAmB,KAAK,EAAE,MAAF,CAAS,cAAT,CAAwB,EAAC,SAAQ,CAAT,EAAxB,CAA/B;AAAoE,WAAG,EAAE,SAAL,EAAe;AAAC,YAAI,IAAE,wDAAN,CAA+D,OAAO,EAAE,GAAF,CAAM,GAAN,CAAU,KAAV,CAAgB,CAAhB,GAAmB,KAAK,EAAE,MAAF,CAAS,cAAT,CAAwB,EAAC,SAAQ,CAAT,EAAxB,CAA/B;AAAoE,SAAE,EAAE,KAAJ,IAAW,EAAE,WAAF,GAAc,CAAC,CAAf,GAAiB,CAA5B;AAA8B,KAAtY,GAAwY,CAA/Y;AAAiZ,GAArzH,EAAszH,EAAE,SAAF,CAAY,IAAZ,GAAiB,UAAS,CAAT,EAAW,CAAX,EAAa,CAAb,EAAe;AAAC,aAAS,CAAT,CAAW,CAAX,EAAa;AAAC,aAAM,EAAE,KAAG,KAAK,CAAL,MAAU,IAAE,EAAE,CAAF,CAAZ,CAAL,CAAN;AAA8B,SAAI,IAAE,EAAE,OAAF,CAAU,KAAV,EAAgB,GAAhB,EAAqB,OAArB,CAA6B,IAA7B,EAAkC,EAAlC,EAAsC,KAAtC,CAA4C,GAA5C,EAAiD,MAAjD,CAAwD,OAAxD,CAAN,CAAuE,OAAO,EAAE,KAAF,CAAQ,CAAR,IAAW,CAAX,GAAa,CAApB;AAAsB,GAAh+H,EAAi+H,CAAx+H;AAA0+H,CAAhjJ","file":"/packages/propellerlabsio:meteor-ui5-mongo/model/Model.js.map","sourcesContent":["\"use strict\";sap.ui.define([\"jquery.sap.global\",\"sap/ui/model/Model\",\"sap/ui/model/BindingMode\",\"sap/ui/model/Context\",\"./DocumentListBinding\",\"./PropertyListBinding\",\"./PropertyBinding\",\"./ContextBinding\",\"sap/ui/model/FilterOperator\"],function(a,b,c,d,e,f,g,h,i){var j=b.extend(\"meteor-ui5-mongo.model.Model\",{constructor:function(a){b.apply(this,arguments),this.oData={},this.bDestroyed=!1,this.aBindings=[],this.mContexts={},this.iSizeLimit=a||100,this.sDefaultBindingMode=c.OneWay,this.mSupportedBindingModes={OneWay:!0,TwoWay:!1,OneTime:!1},this.bLegacySyntax=!1,this.sUpdateTimer=null}});return j.prototype.bindProperty=function(a,b,c){var d=new g(this,a,b,c);return d},j.prototype.bindList=function(a,b,c,d,g){var h;return h=b?new f(this,a,b,c,d,g):new e(this,a,b,c,d,g)},j.prototype.createBindingContext=function(a,b,c,d){\"function\"==typeof b&&(d=b,b=null),\"function\"==typeof c&&(d=c,c=null);var e=this.resolve(a,b),f=void 0==e?void 0:this.getContext(e?e:\"/\");return f||(f=null),d&&d(f),f},j.prototype.destroyBindingContext=function(a){a.hasOwnProperty(\"destroy\")&&a.destroy()},j.prototype.getProperty=function(a,b){var c=void 0;if(b){var d=this._getPathComponents(a,b),e=Mongo.Collection.get(d.collectionName).findOne(d.documentId);return e&&(c=d.propertyPath?\"?\"===d.propertyPath.charAt(0)?this._getLookupProperty(e,d.propertyPath):this._get(e,d.propertyPath):e),c}},j.prototype._getLookupProperty=function(a,b){var c=this._getPathComponents(b),d=\"/\"+c.collectionName+\"(\"+a[c.documentId]+\")\",e=this.getContext(d);return this.getProperty(c.propertyPath,e)},j.prototype._getPathComponents=function(b,c){var d={collectionName:\"\",documentId:\"\",propertyPath:\"\"},e=c?this.resolve(b,c):b,f=e.charAt(0);if(\"?\"===f)e=\"/\"+e.slice(1);else if(\"/\"!==f){var g=\"Cannot find root element (Mongo Collection).\";a.sap.log.fatal(g),this.fireParseError({srcText:g})}var h=e.split(\"/\");if(\"\"===h[0]&&h.shift(),h.length<1){var i=\"Unsupported binding path: \"+e;a.sap.log.fatal(i),oModel.fireParseError({srcText:i})}var j=h[0],k=j.indexOf(\"(\");if(k<0)d.collectionName=j;else{d.collectionName=j.substring(0,k);var l=j.substring(k),m=0,n=l.length-1,o=l.substring(m+1,n);if(o.startsWith(\"Object\")){var p=o.indexOf('\"'),q=o.indexOf('\"',p+1),r=o.substring(p+1,q);d.documentId=new Meteor.Collection.ObjectID(r)}else d.documentId=o}h.shift();var s=h.join(\".\");if(s){var t=s.indexOf(\")\");if(t>-1){var u=t+1;\".\"===s.charAt(u)&&(s=s.substr(0,u)+\"/\"+s.substr(t+1))}}return d.propertyPath=s,d},j.prototype.runQuery=function(a,b,c,d){var e=this._getPathComponents(a,b),f=Mongo.Collection.get(e.collectionName),g={};e.documentId?g._id=e.documentId:d&&d.length&&(g=this._buildMongoSelector(d));var h={limit:this.iSizeLimit};c&&c.length&&(h.sort=this._buildMongoSortSpecifier(c));var i=f.find(g,h);return i},j.prototype.bindContext=function(a,b,c){var d=new h(this,a,b,c);return d},j.prototype.destroy=function(){this.aBindings.forEach(function(a){a.hasOwnProperty(\"destroy\")&&a.destroy()}),b.prototype.destroy.apply(this,arguments)},j.prototype._buildMongoSelector=function(b){var c=this,d={},e=new Map;b.forEach(function(b){if(b._bMultiFilter){var d=\"MultiFilter not yet supported by ListBinding.\";return a.sap.log.fatal(d),void c.oModel.fireParseError({srcText:d})}var f={};switch(b.sOperator){case i.BT:f.$gte=b.oValue1,f.$lte=b.oValue2;break;case i.Contains:f.$regex=new RegExp(b.oValue1),f.$options=\"i\";break;case i.StartsWith:f.$regex=new RegExp(\"^\"+b.oValue1),f.$options=\"i\";break;case i.EndsWith:f.$regex=new RegExp(b.oValue1+\"$\"),f.$options=\"i\";break;case i.EQ:f=b.oValue1;break;case i.GE:f.$gte=b.oValue1;case i.GT:f.$gt=b.oValue1;break;case i.LE:f.$lte=b.oValue1;break;case i.LT:f.$lt=b.oValue1;break;case i.NE:f.$ne=b.oValue1;break;default:var g=\"Filter operator \"+b.sOperator+\" not supported.\";return a.sap.log.fatal(g),void c.oModel.fireParseError({srcText:g})}var h=b.sPath;e.has(h)||e.set(h,[]);var j={};j[h]=f,e.get(h).push(j)});var f=[];return e.forEach(function(a){1===a.length?f.push(a[0]):f.push({$or:a})}),f.length>1?d.$and=f:d=f[0],d},j.prototype._buildMongoSortSpecifier=function(b){var c=this,d={};return b.forEach(function(b){var e=b.sPath.indexOf(\"/\")>-1,f=b.sPath.indexOf(\".\")>-1;if(e||f){var g=\"Currently unsupported list sorting path: \"+b.sPath;return a.sap.log.fatal(g),void c.oModel.fireParseError({srcText:g})}if(b.fnCompare){var h=\"Custom sort comparator functions currently unsupported\";return a.sap.log.fatal(h),void c.oModel.fireParseError({srcText:h})}d[b.sPath]=b.bDescending?-1:1}),d},j.prototype._get=function(a,b,c){function d(b){return!(b&&void 0===(a=a[b]))}var e=b.replace(/\\[/g,\".\").replace(/]/g,\"\").split(\".\").filter(Boolean);return e.every(d)?a:c},j});"]},"hash":"7f6c3a0fd2f399ba8d7c6940c7069d8dbd23016c"}
